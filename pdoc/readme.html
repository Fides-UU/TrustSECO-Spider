<h1>TrustSECO-Spider</h1>
<p>This spider uses a combination of actual spidering (using BeautifulSoup) and API calls (using requests) in order to gather information from GitHub, Libraries.io, CVE and Stack Overflow. It can (if set up correctly) also scan for viruses within the files of a given project.</p>
<h2>GitHub</h2>
<p>Our program retrieves most data-points using GitHub's REST API. Sadly, not all of the wanted data-points were accessible this way. In order to still gather this data, spidering had to be used.</p>
<p>It can currently get the following data-points from GitHub:</p>
<ul>
<li>Repository information:</li>
<li>Number of contributors</li>
<li>Number of users</li>
<li>Number of downloads<ul>
<li>Per release</li>
<li>In total</li>
</ul>
</li>
<li>Number of commits per year:<ul>
<li>In the past year from the current date</li>
<li>In a specific year</li>
</ul>
</li>
<li>Repository language</li>
<li>GitStar ranking</li>
<li>Issues information:</li>
<li>Number of open issues</li>
<li>Number of issues without a response</li>
<li>Number of issues of a specific release</li>
<li>Ratio of open to closed issues</li>
<li>Average issue resolution time</li>
<li>Owner information:</li>
<li>Number of stargazers</li>
</ul>
<h2>Libraries.io</h2>
<p>All of the data-points are gathered using various Libraries.io's APIs.</p>
<p>The currently available data-points are:</p>
<ul>
<li>Project:</li>
<li>Release frequency</li>
<li>Number of dependencies</li>
<li>Number of dependents</li>
<li>Number of releases</li>
<li>Latest release date</li>
<li>First release date</li>
<li>Sourcerank</li>
<li>Repository:</li>
<li>Contributor count</li>
</ul>
<h2>CVE</h2>
<p>The spider can currently query the CVE service, and get all the known CVE codes of vulnerabilities of the given package.</p>
<p>For each of these codes, it can get the following information:</p>
<ul>
<li>CVE ID</li>
<li>Vulnerability score</li>
<li>Affected versions:</li>
<li>Start version</li>
<li>End version</li>
<li>The type thereof (inclusive or exclusive)</li>
</ul>
<h2>Stack Overflow</h2>
<p>The data-points that the spider is currently able to grab from Stack Overflow are:</p>
<ul>
<li>Trend popularity</li>
</ul>
<h2>ClamAV virus scanner</h2>
<p>The data-point that the virus scanner currently returns is the following:</p>
<ul>
<li>Virus ratio</li>
</ul>
<p>This ratio is calculated by scanning all available files within a release, and dividing the amount of virus-containing files by the total amount of files.</p>
<h2>How to use</h2>
<h3>Requirements</h3>
<p>In order to run our program, certain python libraries will have to be installed. This can easily be done by running the <code>pip install -r requirements.txt</code> command from within the <code>TrustSECO-Spider</code> folder.</p>
<p><strong>THIS IS ONLY NEEDED IF RUNNING THE SPIDER AS A STANDALONE SERVICE. IF RUNNING WITHIN DOCKER,  THIS STEP CAN BE SKIPPED</strong></p>
<h3>Running as a service</h3>
<h4>Standalone</h4>
<p>As the other sub-projects will need to request data from the spider, flask was used in order to create an endpoint for this. In order to run the TrustSECO-Spider as a (development) service, simply run <code>python .\app.py</code> command from within the <code>TrustSECO-Spider</code> folder.
This will run a local server on the following address: <code>http://localhost:5000</code>.</p>
<p>For this to work, you will have to manually enter your GitHub and Libraries.io tokens into the .env file.</p>
<h5>Finding the tokens</h5>
<p>The GitHub token can be generated under <code>Settings -&gt; Developer settings -&gt; Personal access tokens</code>. The needed token does not need any of the selectable scopes.</p>
<p>The Libraries.io token can be found under <code>Settings -&gt; API Key</code> after logging in.</p>
<h5>Entering the tokens</h5>
<p>The tokens have to be added to a file called <code>.env</code> which must be located within the <code>TrustSECO-Spider</code> folder. The file should look like this:</p>
<div class="codehilite"><pre><span></span><code><span class="n">GITHUB_TOKEN</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
<span class="n">LIBRARIES_TOKEN</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
</code></pre></div>

<p>Where of course the empty strings must be replaced with your tokens.</p>
<h4>Docker</h4>
<p>Alternatively, the recommended way of running the TrustSECO-Spider is by running it within a Docker container. To do this, you must first install and start up Docker, as otherwise you will not have access to the needed commands.</p>
<p>After Docker is ready, simply open a terminal window within the <code>TrustSECO-Spider</code> folder. Now, there are two different ways of running the Spider, either with or without running the virus scan service. </p>
<p>If you do need the virus scan capabilities, only one command has to be run:</p>
<ol>
<li><code>docker-compose up</code> -&gt; Uses the configuration specified within the 'docker-compose.yml' file to start up the TrustSECO-Spider and the ClamAV virus scanner.</li>
</ol>
<p>If you don't need the virus scan capabilities, please perform the following commands:</p>
<ol>
<li><code>docker build . -t spider-image</code> -&gt; This will create a Docker image with the name "spider-image"</li>
<li><code>docker run --name 'TrustSECO-Spider' spider-image</code> -&gt; This will create a Docker container based off of the Docker image you just made. It will also set the name of the container to 'TrustSECO-Spider' for easy identification.</li>
</ol>
<h3>Setting API tokens</h3>
<p>After running the program as a service as described above, the API tokens for GitHub and Libraries.io must be set. This can be done by sending a POST request to <code>http://localhost:5000/set_tokens</code>. This POST request <strong>MUST</strong> contain the following:</p>
<ol>
<li>A header with the content-type set as <code>application/json</code>.</li>
<li>A JSON input following the schemas found in the <code>JSON schemas</code> folder. The relevant JSON file would be <code>token_input.json</code>.</li>
</ol>
<p>An example of this (using <code>python</code> and the <code>requests</code> library) would be the following:</p>
<div class="codehilite"><pre><span></span><code><span class="n">header</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Content-type&#39;</span><span class="p">:</span><span class="s1">&#39;application/json&#39;</span><span class="p">}</span>

<span class="n">input_json</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s1">&#39;github_token&#39;</span><span class="p">:</span> <span class="s1">&#39;gho_jeshfuehfhsjfe&#39;</span><span class="p">,</span>
  <span class="s1">&#39;libraries_token&#39;</span><span class="p">:</span> <span class="s1">&#39;jdf9328bf87831bfdjs0823&#39;</span>
<span class="p">}</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;http://localhost:5000/set_tokens&#39;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Content-type&#39;</span><span class="p">:</span><span class="s1">&#39;application/json&#39;</span><span class="p">},</span> <span class="n">json</span><span class="o">=</span><span class="n">input_json</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</code></pre></div>

<p><em>Naturally, the tokens provided here are fake, and must be replaced with your own.</em></p>
<p>If only 1 token has to be set/updated, only that 1 token needs to be supplied.</p>
<h3>Getting API tokens</h3>
<p>If needed, the API tokens that the TrustSECO-Spider is currently using can be requested. This can simply be done by sending a GET request to <code>http://localhost:5000/get_tokens</code>. Example:</p>
<div class="codehilite"><pre><span></span><code><span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">GET</span><span class="p">(</span><span class="s1">&#39;http://localhost:5000/set_tokens&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
</code></pre></div>

<h3>Requesting data</h3>
<p>This address can then be used in order to request data. This is done by sending a POST request to the endpoint. This POST request <strong>must</strong> contain the following:</p>
<ol>
<li>A header with the content-type set as <code>application/json</code>.</li>
<li>A JSON input following the schemas found in the <code>JSON schemas</code> folder. The relevant JSON files would be <code>input_example.json</code> and <code>input_structure.json</code>.</li>
</ol>
<p>An example of this (using <code>python</code> and the <code>requests</code> library) would be the following:</p>
<div class="codehilite"><pre><span></span><code><span class="n">header</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Content-type&#39;</span><span class="p">:</span><span class="s1">&#39;application/json&#39;</span><span class="p">}</span>

<span class="n">input_json</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s1">&#39;project_info&#39;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">&#39;project_platform&#39;</span><span class="p">:</span> <span class="s1">&#39;Pypi&#39;</span><span class="p">,</span>
    <span class="s1">&#39;project_owner&#39;</span><span class="p">:</span> <span class="s1">&#39;numpy&#39;</span><span class="p">,</span>
    <span class="s1">&#39;project_name&#39;</span><span class="p">:</span> <span class="s1">&#39;numpy&#39;</span><span class="p">,</span>
    <span class="s1">&#39;project_release&#39;</span><span class="p">:</span> <span class="s1">&#39;v.1.22.1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;project_year&#39;</span><span class="p">:</span> <span class="mi">2021</span>
  <span class="p">},</span>
  <span class="s1">&#39;cve_data_points&#39;</span><span class="p">:</span> <span class="p">[</span>
    <span class="s1">&#39;cve_count&#39;</span><span class="p">,</span>
    <span class="s1">&#39;cve_vulnerabilities&#39;</span><span class="p">,</span>
    <span class="s1">&#39;cve_codes&#39;</span>
  <span class="p">]</span>
<span class="p">}</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;http://localhost:5000/get_data&#39;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Content-type&#39;</span><span class="p">:</span><span class="s1">&#39;application/json&#39;</span><span class="p">},</span> <span class="n">json</span><span class="o">=</span><span class="n">json_input</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
</code></pre></div>

<h4>Virus scanning</h4>
<p>The TrustSECO-Spider also has the ability to scan URLs for viruses. The URLs will be retrieved automatically based off of the project information you give the TrustSECO-Spider.</p>
<p><strong>WARNING: YOU NEED TO FOLLOW THE SECOND SET OF INSTRUCTIONS WITHIN THE 'Docker' INSTALLATION SECTION TO MAKE SURE THE VIRUS SCANNER IS RUNNING</strong></p>
<p><strong>IT CAN TAKE A WHILE FOR THE VIRUS SCANNER TO START UP, SO PLEASE WATCH THE LOG TO MAKE SURE IT IS DONE. THE FINAL MESSAGE SHOULD BE: 'xxx.cvd database is up-to-date'</strong></p>
<p>You can request for the scanning of viruses by performing almost the same steps as in the 'Requesting data' section, however, another field had to be added within the <code>input_json</code> object like so:</p>
<div class="codehilite"><pre><span></span><code><span class="n">header</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Content-type&#39;</span><span class="p">:</span><span class="s1">&#39;application/json&#39;</span><span class="p">}</span>

<span class="n">input_json</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s1">&#39;project_info&#39;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">&#39;project_platform&#39;</span><span class="p">:</span> <span class="s1">&#39;Pypi&#39;</span><span class="p">,</span>
    <span class="s1">&#39;project_owner&#39;</span><span class="p">:</span> <span class="s1">&#39;numpy&#39;</span><span class="p">,</span>
    <span class="s1">&#39;project_name&#39;</span><span class="p">:</span> <span class="s1">&#39;numpy&#39;</span><span class="p">,</span>
    <span class="s1">&#39;project_release&#39;</span><span class="p">:</span> <span class="s1">&#39;v.1.22.1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;project_year&#39;</span><span class="p">:</span> <span class="mi">2021</span>
  <span class="p">},</span>
  <span class="s2">&quot;virus_scanning&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">&quot;virus_ratio&quot;</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>

<p>Other than that added field, the instructions remain the same as in 'Requesting data'.</p>
<h3>Return values</h3>
<p>Depending on which end-point you send a request to (<code>get_data</code>, <code>set_tokens</code> or <code>get_tokens</code>), a certain type of response will be sent.</p>
<p>In case of <code>get_data</code>, the return type will change depending on whether or not the request succeeded. For example, if the request did not contain all the needed information, the return type would be <code>Content-type: text/plain</code> and would contain the reason for the failure (in this case <code>Error: missing project information</code>).</p>
<p>If the request did succeed, the return type would be <code>Content-type: application/json</code>, and the response would include the wanted data in a JSON format.</p>
<p>In case of <code>set_tokens</code>, it will always return <code>Content-type: text/plain</code>.</p>
<p>In case of <code>get_tokens</code>, the return type will always be <code>Content-type: application/json</code>. The JSON structure is the same as what is described within 'token_input.json'.</p>
<p>Please use the content type to avoid trying to grab non-existent JSON data or text.</p>
<h3>Demo</h3>
<p>This project also contains a small demo file (demo.py) which can demo basic functionality. Simply enter <code>python .\demo.py</code> in the command line in order to get a list of possible arguments. With these arguments you can specify which of the demos to run.</p>
<p><strong>IMPORTANT: The Flask service must be started before running the demo, and the tokens must be set in the .env file beforehand too!!!</strong></p>
<p><strong>MAKE SURE THE VIRUS SCANNER IS RUNNING BEFORE ASKING FOR VIRUS-SCAN DATA</strong></p>
<h3>Unit tests</h3>
<p>The project also contains some of the unit tests too. These can be started from within the main <code>TrustSECO-Spider</code> folder using the <code>python -m pytest</code> command in the console.</p>
<p><strong>IMPORTANT: the tokens within the .env file must be removed before running the tests, as they will overwrite the test variables!!!</strong></p>